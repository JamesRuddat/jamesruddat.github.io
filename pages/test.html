<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Uniform Builder - Mobile Friendly</title>
<style>
/* Reset */
* {
  box-sizing: border-box;
}
body {
  font-family: Arial, sans-serif;
  margin: 0; padding: 0;
  background: #f9f9f9;
  color: #222;
}

/* Tabs container */
.uniform-tabs {
  display: flex;
  border-bottom: 2px solid #004080;
  background: #004080;
  color: white;
}
.uniform-tabs button {
  flex: 1;
  padding: 12px;
  background: none;
  border: none;
  color: white;
  font-weight: bold;
  cursor: pointer;
  user-select: none;
}
.uniform-tabs button.active {
  background: #0066cc;
}

/* Tab content */
.tab-content {
  display: none;
  padding: 16px;
  background: white;
  min-height: 400px;
}
.tab-content.active {
  display: block;
}

/* Responsive layout */
.uniform-display {
  display: flex;
  gap: 16px;
  margin-top: 20px;
}
.images-column, .texts-column {
  flex: 1;
}
@media (max-width: 700px) {
  .uniform-display {
    flex-direction: column;
  }
}

/* Search bar */
.search-input {
  width: 100%;
  padding: 8px;
  margin-bottom: 12px;
  border-radius: 4px;
  border: 1px solid #ccc;
  font-size: 1rem;
}

/* Accordion */
.accordion {
  border-top: 1px solid #ddd;
}
.accordion-item {
  border-bottom: 1px solid #ddd;
}
.accordion-header {
  background: #eee;
  padding: 10px;
  cursor: pointer;
  user-select: none;
  font-weight: bold;
}
.accordion-header:hover {
  background: #ddd;
}
.accordion-content {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.25s ease;
  padding-left: 10px;
}
.accordion-content.active {
  max-height: 400px; /* enough for content */
  padding: 10px;
}

/* Form controls */
.form-group {
  margin-bottom: 10px;
}
label {
  display: flex;
  align-items: center;
  font-weight: normal;
  cursor: pointer;
}
input[type="checkbox"], input[type="radio"] {
  margin-right: 10px;
  flex-shrink: 0;
}
select {
  width: 100%;
  padding: 6px;
  border-radius: 4px;
  border: 1px solid #ccc;
}

/* Preview */
#preview-image {
  width: 100%;
  height: 300px;
  background: #ddd url('https://via.placeholder.com/200x300?text=Uniform+Preview') no-repeat center center;
  background-size: contain;
  border-radius: 6px;
  position: relative;
  padding: 10px;
  overflow-y: auto;
  font-size: 0.9rem;
  color: #222;
}

/* Details */
#details-list {
  list-style: none;
  padding-left: 0;
  margin-top: 0;
}
#details-list li {
  border-bottom: 1px solid #ddd;
  padding: 8px 0;
}
#details-list li strong {
  display: block;
  margin-bottom: 4px;
}
#details-list li a {
  color: #0066cc;
  text-decoration: none;
}
#details-list li a:hover {
  text-decoration: underline;
}

/* Tooltip style for preview items */
.preview-item {
  margin-bottom: 6px;
  position: relative;
}
.preview-item:hover .tooltip {
  display: block;
}
.tooltip {
  display: none;
  position: absolute;
  left: 100%;
  top: 50%;
  transform: translateY(-50%);
  background: rgba(0,0,0,0.8);
  color: white;
  padding: 6px 10px;
  border-radius: 4px;
  white-space: nowrap;
  font-size: 0.8rem;
  z-index: 10;
  margin-left: 8px;
  pointer-events: none;
}

/* Disabled styling */
input[disabled] + span {
  opacity: 0.6;
  font-style: italic;
}
</style>
</head>
<body>

<!-- Tabs -->
<div class="uniform-tabs" role="tablist" aria-label="Uniform Builder Tabs">
  <button role="tab" aria-selected="true" aria-controls="tab-select" id="tab-select-btn" class="active" tabindex="0">Select Items</button>
  <button role="tab" aria-selected="false" aria-controls="tab-preview" id="tab-preview-btn" tabindex="-1">Preview</button>
  <button role="tab" aria-selected="false" aria-controls="tab-regs" id="tab-regs-btn" tabindex="-1">Regulations</button>
</div>

<!-- Select Items Tab -->
<div id="tab-select" class="tab-content active" role="tabpanel" aria-labelledby="tab-select-btn">
  <input type="text" id="search-input" class="search-input" placeholder="Search items..." aria-label="Search uniform items" />
  <form id="uniform-form" aria-live="polite" aria-relevant="additions removals">
    <div id="accordion-container" class="accordion"></div>
  </form>
</div>

<!-- Preview Tab -->
<div id="tab-preview" class="tab-content" role="tabpanel" aria-labelledby="tab-preview-btn">
  <section class="uniform-display" aria-label="Uniform preview section">
    <div class="uniform-container">
      <div class="images-column">
        <div id="preview-image" aria-live="polite" aria-atomic="true">No items selected.</div>
      </div>
      <div class="texts-column">
        <div id="overview-text" class="overview-text">General description</div>
        <div id="extra-text" class="extra-text">Extra item description</div>
        <div id="outerwear-text" class="outerwear-text">Outerwear description</div>
      </div>
    </div>
  </section>
</div>

<!-- Regulations Tab -->
<div id="tab-regs" class="tab-content" role="tabpanel" aria-labelledby="tab-regs-btn">
  <div id="reg-main" class="reg-main">Select items to see regulations here.</div>
  <ul id="details-list" aria-live="polite" aria-atomic="true"></ul>
</div>

<script>
(() => {
  // Sample data
  const uniformItems = {
    Boots: [
      { value: 'boot1', label: 'Leather Boots', reference: 'CAP Reg 39-1, para 4.5', required: false },
      { value: 'boot2', label: 'Flight Boots', reference: 'CAP Reg 39-1, para 5.3', required: false },
    ],
    Headgear: [
      { value: 'hat1', label: 'Service Cap', reference: 'CAP Reg 39-1, para 3.2', required: true },
      { value: 'hat2', label: 'Flight Cap', reference: 'CAP Reg 39-1, para 3.3', required: false },
    ],
    Badges: [
      { value: 'badge1', label: 'Pilot Wings', reference: 'CAP Reg 39-1, para 6.1', required: false },
      { value: 'badge2', label: 'NCO Chevron', reference: 'CAP Reg 39-1, para 6.5', required: false },
    ],
  };

  // Get references
  const accordionContainer = document.getElementById('accordion-container');
  const searchInput = document.getElementById('search-input');
  const previewImage = document.getElementById('preview-image');
  const detailsList = document.getElementById('details-list');
  const regMain = document.getElementById('reg-main');

  // Build accordion
  function buildAccordion(itemsData) {
    accordionContainer.innerHTML = '';
    for (const [category, items] of Object.entries(itemsData)) {
      const itemDiv = document.createElement('div');
      itemDiv.classList.add('accordion-item');

      const header = document.createElement('div');
      header.classList.add('accordion-header');
      header.textContent = category;
      itemDiv.appendChild(header);

      const content = document.createElement('div');
      content.classList.add('accordion-content');

      items.forEach(i => {
        const formGroup = document.createElement('div');
        formGroup.classList.add('form-group');

        const label = document.createElement('label');
        label.title = i.reference || '';

        let input;

        // If multiple items in category -> radio (select one)
        if (items.length > 1) {
          input = document.createElement('input');
          input.type = 'radio';
          input.name = `select-${category}`;
          input.value = i.value;
          input.title = i.reference || '';
          input.id = `${category}-${i.value}`;

          // Required item: selected by default, disabled so user can't unselect
          if (i.required) {
            input.checked = true;
            input.disabled = true;
          }
        } else {
          // Single item: checkbox
          input = document.createElement('input');
          input.type = 'checkbox';
          input.value = i.value;
          input.title = i.reference || '';
          input.id = `${category}-${i.value}`;

          if (i.required) {
            input.checked = true;
            input.disabled = true;
          }
        }

        label.appendChild(input);

        // Use a span to allow styling disabled required items differently
        const labelText = document.createElement('span');
        labelText.textContent = ' ' + i.label + (i.required ? ' (Required)' : '');
        label.appendChild(labelText);

        formGroup.appendChild(label);
        content.appendChild(formGroup);
      });

      itemDiv.appendChild(content);
      accordionContainer.appendChild(itemDiv);

      // Accordion toggle logic
      header.addEventListener('click', () => {
        const active = content.classList.contains('active');
        // Close all
        document.querySelectorAll('.accordion-content').forEach(c => c.classList.remove('active'));
        // Toggle current
        if (!active) content.classList.add('active');
      });
    }

    // Open first accordion by default
    const firstAccordion = accordionContainer.querySelector('.accordion-content');
    if (firstAccordion) firstAccordion.classList.add('active');
  }

  // Search filter logic
  function filterAccordion() {
    const filter = searchInput.value.toLowerCase();
    document.querySelectorAll('.accordion-item').forEach(section => {
      const header = section.querySelector('.accordion-header').textContent.toLowerCase();
      const content = section.querySelector('.accordion-content');
      let hasMatch = false;

      content.querySelectorAll('label').forEach(label => {
        const text = label.textContent.toLowerCase();
        if (text.includes(filter)) {
          label.style.display = '';
          hasMatch = true;
        } else {
          label.style.display = 'none';
        }
      });

      // Show section if header or any item matches filter
      section.style.display = (header.includes(filter) || hasMatch) ? '' : 'none';
    });
  }

  // Get selected items from inputs
  function getSelectedItems() {
    const selected = [];
    accordionContainer.querySelectorAll('input[type=checkbox]:checked, input[type=radio]:checked').forEach(input => {
      // Find category from closest accordion-item
      const category = input.closest('.accordion-item')?.querySelector('.accordion-header')?.textContent || '';
      // Label text without "Required"
      const labelSpan = input.parentElement.querySelector('span');
      const labelText = labelSpan ? labelSpan.textContent.replace(' (Required)', '') : input.value;

      // Find reference title (tooltip)
      const reference = input.title || '';

      selected.push({
        value: input.value,
        label: labelText,
        reference,
        category,
      });
    });
    return selected;
  }

  // Render preview box (just a simple list here)
  function renderPreview() {
    const selected = getSelectedItems();
    previewImage.innerHTML = ''; // Clear

    if (selected.length === 0) {
      previewImage.textContent = 'No items selected.';
      previewImage.style.backgroundImage = "url('https://via.placeholder.com/200x300?text=No+Items+Selected')";
      return;
    }

    previewImage.style.backgroundImage = 'none';

    selected.forEach(item => {
      const div = document.createElement('div');
      div.classList.add('preview-item');
      div.textContent = `${item.category}: ${item.label}`;

      if (item.reference) {
        const tooltip = document.createElement('div');
        tooltip.classList.add('tooltip');
        tooltip.textContent = item.reference;
        div.appendChild(tooltip);
      }

      previewImage.appendChild(div);
    });
  }

  // Render regulation details list
  function renderDetails() {
    const selected = getSelectedItems();
    detailsList.innerHTML = '';
    regMain.textContent = '';

    if (selected.length === 0) {
      detailsList.textContent = 'No items selected.';
      return;
    }

    selected.forEach(item => {
      const li = document.createElement('li');
      const strong = document.createElement('strong');
      strong.textContent = item.label;
      li.appendChild(strong);

      if (item.reference) {
        const ref = document.createElement('div');
        ref.textContent = item.reference;
        li.appendChild(ref);
      }

      detailsList.appendChild(li);
    });
  }

  // Event listeners
  searchInput.addEventListener('input', filterAccordion);
  accordionContainer.addEventListener('change', () => {
    renderPreview();
    renderDetails();
  });

  // Tab switching logic
  const tabButtons = document.querySelectorAll('.uniform-tabs button');
  const tabContents = document.querySelectorAll('.tab-content');

  tabButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      const targetId = btn.getAttribute('aria-controls');

      tabButtons.forEach(b => {
        const selected = (b === btn);
        b.classList.toggle('active', selected);
        b.setAttribute('aria-selected', selected);
        b.tabIndex = selected ? 0 : -1;
      });

      tabContents.forEach(tc => {
        tc.classList.toggle('active', tc.id === targetId);
      });
    });
  });

  // Initialize UI
  buildAccordion(uniformItems);
  renderPreview();
  renderDetails();

})();
</script>

</body>
</html>
